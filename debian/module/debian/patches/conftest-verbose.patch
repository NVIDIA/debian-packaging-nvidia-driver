Author: Andreas Beckmann <anbe@debian.org>
Description: dump the generated conftest headers

--- a/Kbuild
+++ b/Kbuild
@@ -200,11 +200,26 @@ $(obj)/$(CORE_OBJS):
 $(obj)/$(VERSION_HEADER):
 	@echo \#define NV_COMPILER \"`$(CC) -v 2>&1 | tail -n 1`\" > $@
 
-$(obj)/conftest.h: $(src)/conftest.sh
+.PHONY: conftest-verbose
+conftest-verbose:
+	@echo 'CONFTEST=$(CONFTEST)'
+	@echo 'CONFTEST_CFLAGS=$(CONFTEST_CFLAGS)'
+	@echo 'KBUILD_CFLAGS=$(KBUILD_CFLAGS)'
+	@echo 'LINUXINCLUDE=$(LINUXINCLUDE)'
+	@echo 'LDFLAGS=$(LDFLAGS)'
+	@echo 'ARCH=$(ARCH)'
+
+$(obj)/conftest.h: $(src)/conftest.sh conftest-verbose
+	@echo " CONFTEST: compile_tests"
 	@if ! $(CONFTEST) compile_tests $(COMPILE_TESTS); then exit 1; fi
+	@echo " CONFTEST $(notdir $@):"
+	@cat $@
 
-$(obj)/patches.h:
+$(obj)/patches.h: $(src)/conftest.sh conftest-verbose
+	@echo " CONFTEST: patch_check"
 	@if ! $(CONFTEST) patch_check; then exit 1; fi
+	@echo " CONFTEST $(notdir $@):"
+	@cat $@
 
 RESMAN_GLUE_TARGETS = $(addprefix $(obj)/,$(RESMAN_GLUE_OBJS))
 
@@ -240,10 +255,14 @@ suser-sanity-check:
 rmmod-sanity-check:
 	@if ! $(CONFTEST) rmmod_sanity_check; then exit 1; fi
 
-build-sanity-checks:
+build-sanity-checks: conftest-verbose
+	@echo " CONFTEST: cc_version_check"
 	@if ! $(CONFTEST) cc_version_check 		full_output; then exit 1; fi
+	@echo " CONFTEST: rivafb_sanity_check"
 	@if ! $(CONFTEST) rivafb_sanity_check 	full_output; then exit 1; fi
+	@echo " CONFTEST: nvidiafb_sanity_check"
 	@if ! $(CONFTEST) nvidiafb_sanity_check full_output; then exit 1; fi
+	@echo " CONFTEST: xen_sanity_check"
 	@if ! $(CONFTEST) xen_sanity_check 		full_output; then exit 1; fi
 
 #
--- a/conftest.sh
+++ b/conftest.sh
@@ -2098,6 +2098,11 @@ case "$6" in
         #
         shift 5
 
+	echo "conftest.sh: CC=$CC"
+	echo "conftest.sh: CFLAGS=$CFLAGS"
+	echo "conftest.sh: KBUILD_CFLAGS=$KBUILD_CFLAGS"
+	echo "conftest.sh: ARCH=$ARCH"
+
         rm -f conftest.h
         test_headers
 
