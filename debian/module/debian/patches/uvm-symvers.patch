Author: Andreas Beckmann <anbe@debian.org>
Description: fix up the ../Module.symvers dependency for our uvm build

--- a/uvm/Kbuild
+++ b/uvm/Kbuild
@@ -226,6 +226,8 @@ $(MODULE_NAME)-y := $(MODULE_GLUE_OBJS)
 include $(RM_OUT_DIR)/nvidia-modules-common.mk
 
 $(RM_MODULE_SYMVERS):
+	@echo "*** Please build the nvidia.ko module first ***"
+	exit 1
 	cd $(RM_OUT_DIR); make module SYSSRC=$(KERNEL_SOURCES) SYSOUT=$(KERNEL_OUTPUT) KBUILD_EXTMOD=$(RM_OUT_DIR)
 
 $(UVM_MODULE_SYMVERS): $(RM_MODULE_SYMVERS)
--- a/Makefile
+++ b/Makefile
@@ -30,6 +30,14 @@ KBUILD_PARAMS += -C $(KERNEL_SOURCES) M=
 default: modules
 .PHONY: default
 
+ifneq (,$(filter %/uvm,$(CURDIR)))
+modules: HACK
+
+HACK:
+	# We need Module.symvers from the regular nvidia module.
+	cp ../Module.symvers .
+endif
+
 # hand over to kbuild
 %::
 	$(MAKE) $(KBUILD_PARAMS) $@
