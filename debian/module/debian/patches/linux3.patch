Author: Antonio Ospite <ospite@studenti.unina.it>
Author: Andreas Beckmann <debian@abeckmann.de>
Subject: Make the nvidia module build on linux-3.0.0
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=628925

Index: nvidia-270.41.19/Makefile
===================================================================
--- nvidia-270.41.19.orig/Makefile	2011-06-02 09:58:55.000000000 +0200
+++ nvidia-270.41.19/Makefile	2011-06-02 09:59:17.000000000 +0200
@@ -158,7 +158,7 @@
 
 # Check for kernel versions that we don't support.
 
-BELOW26 := $(shell if [ $(VERSION) -lt 2 -o $(PATCHLEVEL) -lt 6 ]; then \
+BELOW26 := $(shell if [ $(VERSION) -lt 2 -o \( $(VERSION) = 2 -a $(PATCHLEVEL) -lt 6 \) ]; then \
 		echo y; fi)
 
 ifeq ($(BELOW26),y)
Index: nvidia-270.41.19/nv-linux.h
===================================================================
--- nvidia-270.41.19.orig/nv-linux.h	2011-06-02 09:59:29.000000000 +0200
+++ nvidia-270.41.19/nv-linux.h	2011-06-02 10:00:11.000000000 +0200
@@ -34,7 +34,7 @@
 #  define KERNEL_2_4
 #elif LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 0)
 #  error This driver does not support 2.5 kernels!
-#elif LINUX_VERSION_CODE < KERNEL_VERSION(2, 7, 0)
+#elif LINUX_VERSION_CODE < KERNEL_VERSION(4, 0, 0)
 #  define KERNEL_2_6
 #else
 #  error This driver does not support development kernels!
