Author: Luca Boccassi <luca.boccassi@gmail.com>
Description: Fix drm master device API usage for kernel >= 4.8
 From kernel 4.8 and newer (commits 34a839c68 5e84c2690b8 d6ed682eba5) DRM
 master device APIs have changed. Patch nvidia-drm kernel module code to fix
 build failure.
--- a/nvidia-drm/nvidia-drm-modeset.c
+++ b/nvidia-drm/nvidia-drm-modeset.c
@@ -77,6 +77,8 @@
 }
 #endif
 
+#include <linux/version.h>
+
 /*
  * In kernel versions before the addition of
  * drm_crtc_state::connectors_changed, connector changes were
@@ -891,7 +893,11 @@
         atomic_set(&nv_crtc->has_pending_flip_event, true);
     }
 
+#if LINUX_VERSION_CODE < KERNEL_VERSION(4,8,0)
     drm_atomic_helper_swap_state(dev, state);
+#else
+    drm_atomic_helper_swap_state(state, true);
+#endif
 
     INIT_WORK(&nv_commit_task->work,
               nvidia_drm_atomic_commit_task_callback);
