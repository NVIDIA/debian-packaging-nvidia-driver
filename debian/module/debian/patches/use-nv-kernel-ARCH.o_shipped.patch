Author: Andreas Beckmann <anbe@debian.org>
Description: Select the correct nv-kernel.o blob for the target architecture
 The Debian nvidia-kernel-source package supports building for both i386 and
 amd64 kernels (on i386) from one source by including both binary objects.
 This patch makes the build system select the correct one depending on the
 kernel architecture the module is built for.

--- a/Kbuild
+++ b/Kbuild
@@ -82,6 +82,14 @@ define INSTANCE_DEPENDENCIES
  $(subst nv-instance,nv-instance-$(strip $(1)),$(INSTANCE_GLUE_OBJS))
 endef
 
+$(MODULE_NAME)-objs :=
+$(MODULE_NAME)-y		 = $(MODULE_GLUE_OBJS)
+ifneq ($(NV_MODULE_SUFFIX),frontend)
+$(MODULE_NAME)-$(CONFIG_X86_32)	+= nv-kernel-i386.o_shipped
+$(MODULE_NAME)-$(CONFIG_X86_64)	+= nv-kernel-amd64.o_shipped
+$(MODULE_NAME)-$(CONFIG_ARM)	+= nv-kernel-armhf.o_shipped
+endif
+
 #
 # Multi-module builds require GNU Make v3.81 or later, due to a bug in earlier
 # versions of GNU Make that prevents the use of $(eval) within a $(foreach):
